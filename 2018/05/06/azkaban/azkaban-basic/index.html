<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Azkaban的基本概念、部署及使用"><meta name="keywords" content="Azkaban"><meta name="author" content="VinxC"><meta name="copyright" content="VinxC"><title>Azkaban的基本概念、部署及使用 | VinxC's blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Azkaban的基本概念"><span class="toc-number">1.</span> <span class="toc-text">Azkaban的基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#什么是Azkaban"><span class="toc-number">1.1.</span> <span class="toc-text">什么是Azkaban</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常见的工作流调度系统"><span class="toc-number">1.2.</span> <span class="toc-text">常见的工作流调度系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ooize和azkaban的对比"><span class="toc-number">1.3.</span> <span class="toc-text">ooize和azkaban的对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Azkaban的架构"><span class="toc-number">1.4.</span> <span class="toc-text">Azkaban的架构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Azkaban部署"><span class="toc-number">2.</span> <span class="toc-text">Azkaban部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Azkaban-3-x源码编译"><span class="toc-number">2.1.</span> <span class="toc-text">Azkaban-3.x源码编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Azkaban安装"><span class="toc-number">2.2.</span> <span class="toc-text">Azkaban安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置Azkaban数据库"><span class="toc-number">2.3.</span> <span class="toc-text">配置Azkaban数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部署Azkaban-Web-Server"><span class="toc-number">2.4.</span> <span class="toc-text">部署Azkaban Web Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部署Azkaban-Exec-Server"><span class="toc-number">2.5.</span> <span class="toc-text">部署Azkaban Exec Server</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Azkaban的使用"><span class="toc-number">3.</span> <span class="toc-text">Azkaban的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简单的job"><span class="toc-number">3.1.</span> <span class="toc-text">简单的job</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建多job，有依赖关系的project"><span class="toc-number">3.2.</span> <span class="toc-text">创建多job，有依赖关系的project</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://vinxikk.github.io/img/avatar.png"></div><div class="author-info__name text-center">VinxC</div><div class="author-info__description text-center">A Bigdata Developer</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">90</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">95</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">17</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://molunerfinn.com" target="_blank" rel="noopener">Molunerfinn</a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">VinxC's blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">Azkaban的基本概念、部署及使用</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-06</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Azkaban/">Azkaban</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2k</span><span class="post-meta__separator">|</span><span>Reading time: 8 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="Azkaban的基本概念"><a href="#Azkaban的基本概念" class="headerlink" title="Azkaban的基本概念"></a>Azkaban的基本概念</h3><h4 id="什么是Azkaban"><a href="#什么是Azkaban" class="headerlink" title="什么是Azkaban"></a>什么是Azkaban</h4><p>官网：<a href="https://azkaban.github.io/" target="_blank" rel="noopener">https://azkaban.github.io/</a></p>
<p>Github开源项目：<a href="https://github.com/azkaban" target="_blank" rel="noopener">https://github.com/azkaban</a></p>
<p>官方描述：</p>
<p><strong>Azkaban</strong> is a batch workflow job scheduler created at LinkedIn to run Hadoop jobs. Azkaban resolves the ordering through job dependencies and provides an easy to use web user interface to maintain and track your workflows.</p>
<p>Azkaban是由Linkedin公司推出的一个批量工作流任务调度器，主要用于在一个工作流内以一个特定的顺序运行一组工作和流程，它的配置是通过简单的key:value对的方式，通过配置中的dependencies 来设置依赖关系。</p>
<p>Azkaban使用job配置文件建立任务之间的依赖关系，并提供一个易于使用的web用户界面维护和跟踪你的工作流。</p>
<h4 id="常见的工作流调度系统"><a href="#常见的工作流调度系统" class="headerlink" title="常见的工作流调度系统"></a>常见的工作流调度系统</h4><p>简单的任务调度：直接使用crontab实现。</p>
<p>复杂的任务调度：开发调度平台或使用现成的开源调度系统，比如ooize、azkaban等。</p>
<h4 id="ooize和azkaban的对比"><a href="#ooize和azkaban的对比" class="headerlink" title="ooize和azkaban的对比"></a>ooize和azkaban的对比</h4><table>
<thead>
<tr>
<th>调度平台</th>
<th>Oozie</th>
<th>Azkaban</th>
</tr>
</thead>
<tbody><tr>
<td>工作流描述语言</td>
<td>xml</td>
<td>text file with key/value pairs</td>
</tr>
<tr>
<td>是否要web容器</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>进度跟踪</td>
<td>web page</td>
<td>web page</td>
</tr>
<tr>
<td>Hadoop job调度支持</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>运行模式</td>
<td>daemon</td>
<td>daemon</td>
</tr>
<tr>
<td>事件通知</td>
<td>no</td>
<td>yes</td>
</tr>
<tr>
<td>需要安装</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr>
<td>重试支持</td>
<td>workflownode evel</td>
<td>yes</td>
</tr>
<tr>
<td>运行任意命令</td>
<td>yes</td>
<td>yes</td>
</tr>
</tbody></table>
<h4 id="Azkaban的架构"><a href="#Azkaban的架构" class="headerlink" title="Azkaban的架构"></a>Azkaban的架构</h4><p><img src="https://vinxikk.github.io/img/azkaban/azkaban-architecture.png" alt="Azkaban的架构"></p>
<p>Azkaban由三个关键组件构成：</p>
<ol>
<li><p>AzkabanWebServer：整个Azkaban工作流系统的主要管理者，它负责用户登录认证、project管理、定时执行工作流、跟踪工作流执行进度等一系列任务。</p>
</li>
<li><p>AzkabanExecutorServer：负责具体的工作流的提交、执行，它们通过mysql数据库来协调任务的执行。</p>
</li>
<li><p>MySQL：存储大部分执行流状态，AzkabanWebServer和AzkabanExecutorServer都需要访问数据库。</p>
<p>在分布式集群环境中，一般选择Mysql作为Azkaban数据库，因为Azkaban建立了一些Mysql连接增强功能，方便Azkaban设置，并增强服务可靠性。</p>
</li>
</ol>
<h3 id="Azkaban部署"><a href="#Azkaban部署" class="headerlink" title="Azkaban部署"></a>Azkaban部署</h3><h4 id="Azkaban-3-x源码编译"><a href="#Azkaban-3-x源码编译" class="headerlink" title="Azkaban-3.x源码编译"></a>Azkaban-3.x源码编译</h4><p>版本选择：最新版本，3.47.0</p>
<p>下载地址：<a href="https://github.com/azkaban/azkaban/archive/3.47.0.tar.gz" target="_blank" rel="noopener">https://github.com/azkaban/azkaban/archive/3.47.0.tar.gz</a></p>
<p>环境要求：</p>
<ul>
<li>jdk1.8 + </li>
<li>Git: yum install git -y 或者编译安装，参考：<a href="https://www.cnblogs.com/fuyuanming/p/5804695.html" target="_blank" rel="noopener">https://www.cnblogs.com/fuyuanming/p/5804695.html</a></li>
</ul>
<p>源码编译官方参考：</p>
<p><a href="https://azkaban.readthedocs.io/en/latest/getStarted.html#building-from-source" target="_blank" rel="noopener">https://azkaban.readthedocs.io/en/latest/getStarted.html#building-from-source</a></p>
<p>解压源码包：<code>tar -zxvf azkaban-3.47.0.tar.gz</code></p>
<p>优化gradle：</p>
<p>查看azkaban-3.47.0/gradle/wrapper/gradle-wrapper.properties，发现：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">distributionUrl</span>=<span class="string">https\://services.gradle.org/distributions/gradle-4.1-all.zip</span></span></pre></td></tr></table></figure>

<p>可以看到，依赖的gradle为4.1版本，从<a href="https://gradle.org/releases/下载对应版本的gradle的zip包，放到azkaban-3.47.0/gradle/wrapper目录下。" target="_blank" rel="noopener">https://gradle.org/releases/下载对应版本的gradle的zip包，放到azkaban-3.47.0/gradle/wrapper目录下。</a></p>
<p>然后<code>vi gradle-wrapper.properties</code>，修改以下内容：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="attr">distributionUrl</span>=<span class="string">gradle-4.1-all.zip</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># distributionUrl=https\://services.gradle.org/distributions/gradle-4.1-all.zip</span></span></pre></td></tr></table></figure>

<p>编译源码：</p>
<p>在解压目录下有一个可执行文件gradlew，进行以下操作：</p>
<p><code>./gradlew build installDist -x test</code></p>
<p>中间如果遇到报错的情况，多执行几次，主要的问题就是依赖的jar包下不来，网络问题，多试几次，直到build success。</p>
<p>编译成功信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">BUILD SUCCESSFUL in 9m 18s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">105 actionable tasks: 80 executed, 25 up-to-date</span></pre></td></tr></table></figure>

<p>编译成功后，需要的安装包也已经打包好了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">azkaban-3.47.0&#x2F;azkaban-db&#x2F;build&#x2F;distributions</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">azkaban-3.47.0&#x2F;azkaban-exec-server&#x2F;build&#x2F;distributions</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">azkaban-3.47.0&#x2F;azkaban-hadoop-security-plugin&#x2F;build&#x2F;distributions</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">azkaban-3.47.0&#x2F;azkaban-solo-server&#x2F;build&#x2F;distributions</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">azkaban-3.47.0&#x2F;azkaban-web-server&#x2F;build&#x2F;distributions</span></pre></td></tr></table></figure>

<p>找到的.tar.gz文件分别是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">azkaban-db-0.1.0-SNAPSHOT.tar.gz</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">azkaban-hadoop-security-plugin-0.1.0-SNAPSHOT.tar.gz</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">azkaban-solo-server-0.1.0-SNAPSHOT.tar.gz</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">azkaban-web-server-0.1.0-SNAPSHOT.tar.gz</span></pre></td></tr></table></figure>

<h4 id="Azkaban安装"><a href="#Azkaban安装" class="headerlink" title="Azkaban安装"></a>Azkaban安装</h4><p>编译完成后，在各个模块下的build/distributions目录下可以得到相应的安装包，有.tar.gz和.zip两种压缩格式，任意选择其中一种，这里我们选择tar包。</p>
<p>这里主要需要：azkaban-db-0.1.0-SNAPSHOT.tar.gz、azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz和azkaban-web-server-0.1.0-SNAPSHOT.tar.gz这三个。</p>
<h4 id="配置Azkaban数据库"><a href="#配置Azkaban数据库" class="headerlink" title="配置Azkaban数据库"></a>配置Azkaban数据库</h4><p>解压安装包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ tar zxvf azkaban-db-0.1.0-SNAPSHOT.tar.gz -C ../app/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../app/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$ ln -s azkaban-db-0.1.0-SNAPSHOT azkaban-db</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> azkaban-db</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">$ ll</span></pre></td></tr></table></figure>

<p>可以看到有create-all-sql-0.1.0-SNAPSHOT.sql文件，将其拷贝到合适的地方，并修改为恰当的执行权限。</p>
<p>进入mysql交互模式，<code>mysql -uroot -p123456</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> azkaban;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> azkaban;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建相关表</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">source /root/scripts/<span class="keyword">create</span>-<span class="keyword">all</span>-<span class="keyword">sql</span><span class="number">-0.1</span><span class="number">.0</span>-SNAPSHOT.sql</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span></pre></td></tr></table></figure>

<h4 id="部署Azkaban-Web-Server"><a href="#部署Azkaban-Web-Server" class="headerlink" title="部署Azkaban Web Server"></a>部署Azkaban Web Server</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ tar zxvf azkaban-web-server-0.1.0-SNAPSHOT.tar.gz -C ../app/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../app/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$ ln -s azkaban-web-server-0.1.0-SNAPSHOT azkaban-web-server</span></pre></td></tr></table></figure>

<p>对conf目录下的azkaban.properties文件进行配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># azkaban集群名称</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="meta">azkaban.name</span>=<span class="string">Vinx</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="meta">azkaban.label</span>=<span class="string">My Azkaban</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># azkaban用户管理</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="meta">user.manager.class</span>=<span class="string">azkaban.user.XmlUserManager</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="meta">user.manager.xml.file</span>=<span class="string">conf/azkaban-users.xml</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 端口信息，默认8081</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="meta">jetty.use.ssl</span>=<span class="string">false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="meta">jetty.maxThreads</span>=<span class="string">25</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="meta">jetty.port</span>=<span class="string">8081</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库链接配置</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="meta">database.type</span>=<span class="string">mysql</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.port</span>=<span class="string">3306</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.host</span>=<span class="string">localhost</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.database</span>=<span class="string">azkaban</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.user</span>=<span class="string">root</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.password</span>=<span class="string">123456</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.numconnections</span>=<span class="string">100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多executor模式</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="meta">azkaban.use.multiple.executors</span>=<span class="string">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="meta">azkaban.executorselector.filters</span>=<span class="string">StaticRemainingFlowSize,CpuStatus</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="meta">azkaban.executorselector.comparator.NumberOfAssignedFlowComparator</span>=<span class="string">1</span></span></pre></td></tr></table></figure>

<p>用户相关的配置文件azkaban-users.xml，此处暂不修改：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">azkaban-users</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">user</span> <span class="attr">groups</span>=<span class="string">"azkaban"</span> <span class="attr">password</span>=<span class="string">"azkaban"</span> <span class="attr">roles</span>=<span class="string">"admin"</span> <span class="attr">username</span>=<span class="string">"azkaban"</span>/&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">user</span> <span class="attr">password</span>=<span class="string">"metrics"</span> <span class="attr">roles</span>=<span class="string">"metrics"</span> <span class="attr">username</span>=<span class="string">"metrics"</span>/&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">role</span> <span class="attr">name</span>=<span class="string">"admin"</span> <span class="attr">permissions</span>=<span class="string">"ADMIN"</span>/&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">role</span> <span class="attr">name</span>=<span class="string">"metrics"</span> <span class="attr">permissions</span>=<span class="string">"METRICS"</span>/&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">azkaban-users</span>&gt;</span></span></pre></td></tr></table></figure>

<p>azkaban默认配置中有两个用户，分别为azkaban和metrics，可以根据需要自行添加相关用户。</p>
<p>启动服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ bin/start-web.sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$ jps -m</span></pre></td></tr></table></figure>

<p>此时，进程可能起不来，需要激活ExecServer。</p>
<h4 id="部署Azkaban-Exec-Server"><a href="#部署Azkaban-Exec-Server" class="headerlink" title="部署Azkaban Exec Server"></a>部署Azkaban Exec Server</h4><p>解压：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ tar zxvf azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz -C ../app/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../app/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$ ln -s azkaban-exec-server-0.1.0-SNAPSHOT azkaban-exec-server</span></pre></td></tr></table></figure>

<p>对conf目录下的azkaban.properties文件进行配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># azkaban集群名称</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="meta">azkaban.name</span>=<span class="string">Vinx</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="meta">azkaban.label</span>=<span class="string">My Azkaban</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># azkaban web server地址</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="meta">azkaban.webserver.url</span>=<span class="string">http://hadoop002:8081</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库链接配置</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="meta">database.type</span>=<span class="string">mysql</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.port</span>=<span class="string">3306</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.host</span>=<span class="string">localhost</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.database</span>=<span class="string">azkaban</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.user</span>=<span class="string">root</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.password</span>=<span class="string">123456</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql.numconnections</span>=<span class="string">100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Executor配置</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="meta">executor.maxThreads</span>=<span class="string">50</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="meta">executor.flow.threads</span>=<span class="string">30</span></span></pre></td></tr></table></figure>

<p>启动服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ bin/start-exec.sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看相关进程</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$ jps -m</span></pre></td></tr></table></figure>

<p>azkaban exec server启动之后，还需要一步操作，需要激活当前的exec server，查看exec server日志，获取当前execserver的端口，然后通过访问url进行激活。</p>
<p>在此之前，先登录MySQL的azkaban数据库查看一下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from executors;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">+<span class="comment">----+-----------+-------+--------+</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">| id | host      | port  | active |</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">+<span class="comment">----+-----------+-------+--------+</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">|  1 | hadoop002 | 46062 |      0 |</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">+<span class="comment">----+-----------+-------+--------+</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span></pre></td></tr></table></figure>

<p>可以看到，激活的executor为0，下面我们来激活exec server：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看exec server启动日志，获取当前监听端口</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">[vinx@hadoop002 azkaban-web-server]$ tail -f logs/azkaban-execserver.log</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过访问url对当前execserver进行激活，将端口替换为你的端口即可</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">[vinx@hadoop002 azkaban-web-server]$ curl http://hadoop002:46062/executor?action=activate</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"status"</span>:<span class="string">"success"</span>&#125;</span></pre></td></tr></table></figure>

<p>此时，再次访问数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from executors;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">+----+-----------+-------+--------+</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">| id | host      | port  | active |</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">+----+-----------+-------+--------+</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">|  1 | hadoop002 | 46062 |      1 |</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">+----+-----------+-------+--------+</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">1 row in set (0.00 sec)</span></pre></td></tr></table></figure>

<p>可以看到exec server已经激活，此时再启动web server，发现<code>[AzkabanWebServer] [Azkaban] Server started</code>。</p>
<p>然后访问web界面：<a href="http://hadoop002:8081/" target="_blank" rel="noopener">http://hadoop002:8081/</a></p>
<p>初始用户名和密码都是<code>azkaban</code>。</p>
<p>至此，Azkaban成功完成从源码编译到安装部署启动。</p>
<p>当然，默认时区是America/Los_Angeles，可以根据需要改为Asia/Shanghai，其他配置也可以按照自己的需要进行自定义。</p>
<h3 id="Azkaban的使用"><a href="#Azkaban的使用" class="headerlink" title="Azkaban的使用"></a>Azkaban的使用</h3><h4 id="简单的job"><a href="#简单的job" class="headerlink" title="简单的job"></a>简单的job</h4><p>首先创建一个简单的command类型的任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">mkdir cmd_test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> cmd_test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">vi cmd_test.job</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入以下内容</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#command</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>=<span class="built_in">command</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span>=sh test.sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">vi test.sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入以下内容</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"hello azkaban"</span></span></pre></td></tr></table></figure>

<p>创建完成之后，对cmd_test目录进行压缩，压缩成zip格式。</p>
<p><code>zip -r cmd_test.zip cmd_test</code></p>
<p>登录azkaban web界面<a href="http://hadoop002:8081，新建project，上传zip包，并执行任务。" target="_blank" rel="noopener">http://hadoop002:8081，新建project，上传zip包，并执行任务。</a></p>
<p>可以看到，任务成功运行。</p>
<h4 id="创建多job，有依赖关系的project"><a href="#创建多job，有依赖关系的project" class="headerlink" title="创建多job，有依赖关系的project"></a>创建多job，有依赖关系的project</h4><p>创建文件夹，存放工作流脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">mkdir workflow_test</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> workflow_test</span></pre></td></tr></table></figure>

<p>创建job文件，并指定依赖关系：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">vi job1.job</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>=<span class="built_in">command</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span>=sh job1.sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">vi job2.job</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># jog2依赖于job1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>=<span class="built_in">command</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span>=sh job2.sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">dependencies=job1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">vi job3.job</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># jog3依赖于job1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>=<span class="built_in">command</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span>=sh job3.sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">dependencies=job1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">vi job4.job</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># jog4依赖于job2,job3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>=<span class="built_in">command</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span>=sh job4.sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">dependencies=job2,job3</span></pre></td></tr></table></figure>

<p><code>vi job1.sh</code>，并输入以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/sh</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"job1 exec over"</span></span></pre></td></tr></table></figure>

<p>依次创建job2.sh，job3.sh，job4.sh。</p>
<p>将workflow_test文件夹打成zip包，并上传。</p>
<p>在Execute Flow里可以看到各个job之间的依赖关系：</p>
<p><img src="https://vinxikk.github.io/img/azkaban/azkaban-dependenies-project.png" alt="Job之间的依赖关系"></p>
<p>点击右下角的Execute，等待执行完成后，可以查看详细的log信息。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">VinxC</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="/https:/vinxikk.github.io/2018/05/06/azkaban/azkaban-basic/">https://vinxikk.github.io/2018/05/06/azkaban/azkaban-basic/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Azkaban/">Azkaban</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/05/07/dw/dw-data-rebrush/"><i class="fa fa-chevron-left">  </i><span>数据重刷机制</span></a></div><div class="next-post pull-right"><a href="/2018/05/02/sqoop/sqoop-mongodb-to-hive/"><span>MongoDB同步数据到Hive</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2020 By VinxC</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>